# 从帮助开始

| 命令或参数       | 描述                                           | 常用格式          |
|------------------|------------------------------------------------|-------------------|
| help             | 只支持Shell的内部命令                          | help echo         |
| man              | 命令、配置文件、编程等<br>只要安装了man帮助文档，即可用man查询<br>帮助文档一般安装在/usr/share/man下面 | man echo          |
| info             | 比man更为详细                                  | info echo         |
| -help or --help  | 大多数命令提供                                 | man --help        |

# 文件系统

`pwd`：查看当前路径

| 用途               | 命令 | 参数 | 说明                   |
|--------------------|------|------|------------------------|
| 显示当前路径下的文件和目录 | ls   | -l     | 长列表格式输出         |
|                    |      | -a     | 显示以 “.” 开头的隐藏文件或目录 |
|                    |      | -t     | 按修改时间排序         |
|                    |      | -r     | 反序                   |
|                    |      | -F     | 可用于区分文件和目录   |

输入 `ls -l` 时，显示的每一列内容为：

- 类型：
    - 类型 (d): 目录
    - 类型 (-): 文件
    - 类型 (l): 链接
    - 类型 (c): 字符设备
    - 类型 (b): 块设备
    - 类型 (n): 网络设备
- 硬链接总数
- 属主用户名
- 属主组名
- 文件大小
- 最后一次修改时间
- 文件名或目录名

# bash 中的正则

## 通配符

| 用途                       | 字符            | 说明                                   |
|----------------------------|-----------------|----------------------------------------|
| 匹配0个或多个字符          | `*`             | `a*b`，可以匹配 `ab`, `axyzb`, `a012b`           |
| 匹配任意一个字符           | `?`             | `a?b`，可以匹配 `acb`, `a1b`, `aab`           |
| 匹配列表中的任意一个字符    | `[abc]`         | `x[abc]y`，可以匹配 `xay`, `xby`, `xcy`       |
| 匹配列表外的任意一个字符    | `[!abc]`        | `x[!abc]y`，可以匹配 `xdy`, `xey`，不能匹配 `xay`, `xby` 或 `xcy` |
| 匹配字符范围               | `[a-z]`         | `x[a-z]y`，可以匹配 `xhy`              |
| 匹配字符范围以外的任意一个字符 | `[!a-z]`        | `x[!a-z]y`，可以匹配 `xHy`，但不能匹配 `xhy`       |
| 匹配给定的其中一个字符串    | `{str1, str2...}` | `x{aabb, 123, abcd}y`，`x` 和 `y` 之间只能是 3 个字符串中的某一个 |

## 元字符

| 用途             | 字符      | 说明                                                                 |
|------------------|-----------|----------------------------------------------------------------------|
| 变量赋值         | `=`       | `x=4`，注意等号两侧没有空格                                         |
| 变量替换         | `$` 或 `${}` | 如 `x=1 && echo ${x}yz`，输出 `1yz`                               |
| 命令替换         | `$()` 或 \`\` | `echo $(ls -l)` 或者 echo \`ls -l\`                          |
| 重定向           | `>`       | 将标准输出重定向，如 `cat file.conf > file`                        |
|                  | `<`       | 将标准输入重定向，如 `cat < file`                                    |
|                  | `>>`      | 将标准输出以追加的方式重定向                                         |
| 管道             | `|`       | `x | y`，将 `x` 的标准输出作为 `y` 的标准输入                      |
| 后台执行         | `&`       | 后台运行命令                                                       |
| 前一命令返回 true，则执行下一个命令 | `&&`     | 如 `make && make install`                                           |

## 转义符

| 用途                | 字符       | 说明                                       |
|---------------------|------------|------------------------------------------|
| 转义               | `\`        | 去除通配符、元字符的特殊意义              |
| 硬转义，所有通配符、元字符都会被关掉 | `''`          | 硬转义中不能出现单引号                  |
| 软转义，不屏蔽部分元字符    | `""`         | \`, \\, $ 可以按其元字符定义使用      |

# 文件

## 文件查找

| 用途            | 命令     | 参数           | 说明                                      |
|-----------------|----------|----------------|-----------------------------------------|
| 查找某个命令    | `which`  | `CMD`          | 在 `$PATH` 变量指定的路径中搜索某个命令的位置 |
| 实时查找文件或目录 | `find`   | `[PATH] [EXPRESSION]` | 默认为当前目录要搜索的文件特征，如常用的 `-name xxx` <br>注意 `find` 不在文件内容中查找 |
| 从缓存中查找文件 | `locate` | `FILES`        | 要查找的文件或目录<br>`find -name xxx` 的加速版，但更推荐用 `find` |
| 更新文件缓存数据库 | `updatedb` | N/A          | 与 `locate` 配合使用                     |

## 文件处理

| 用途            | 命令   | 参数               | 说明                                   |
|-----------------|--------|--------------------|--------------------------------------|
| 创建文件或更新文件时间 | `touch` | `FILE`         | 欲创建的文件名                      |
| 复制文件        | `cp`   | `-r`<br>`SOURCE`<br>`DEST` | 递归复制<br>源文件或目录<br>目标文件或目录 |
| 重命名或移动文件 | `mv`   | `SOURCE`<br>`DEST` | 源文件或目录<br>目标文件或目录       |
| 删除文件        | `rm`   | `-r`<br>`-f`<br>`FILE` | 递归删除<br>强制删除不提示<br>欲删除的文件或目录 |
| 创建链接        | `ln`   | `-s`<br>`TARGET`<br>`LINK_NAME` | 软/符号链接，不加则为硬链接<br>欲创建哪个文件的链接<br>链接名字 |

软链接相当于是原始文件的快捷方式，硬链接相当于和原文件共用一个引用计数。如果删除原文件，软链接会打不开，但是硬链接仍然可以使用。

## 目录处理

| 用途      | 命令          | 参数             | 参数说明                             |
|-----------|---------------|------------------|-------------------------------------|
| 创建目录  | `mkdir`       | `-p`<br>`DIRECTORY` | 根据需要创建缺失的父目录<br>欲创建的目录名 |
| 删除目录  | `rm (rmdir不实用)` | `-rf`<br>`DIRECTORY` | 递归删除该目录下的所有目录和文件<br>欲删除的目录名 |

## 文件查看

| 用途          | 命令   | 参数           | 参数说明                           |
|---------------|--------|----------------|------------------------------------|
| 查看文件内容  | `cat`  | `FILE`        | 欲查看的文件                       |
| 分页查看文件内容 | `more` | `FILE`        | 欲查看的文件                       |
| “Less is more” | `less` | `FILE`        | 欲查看的文件                       |
| 查看文件末尾   | `tail` | `-n`<br>`-f`<br>`FILE` | 指定查看的行数，不指定则为 10<br>不断显示添加到文件中的内容<br>欲查看的文件 |
| 查看文件开头   | `head` | `-n`<br>`FILE` | 指定查看的行数，不指定则为 10<br>欲查看的文件 |

## 文件权限

文件权限三组：

1. 文件属主权限
2. 属组成员权限
3. 其他用户权限

| 用途          | 命令   | 参数                     | 参数说明                           |
|---------------|--------|--------------------------|------------------------------------|
| 更改文件权限 | chmod  | \[ugo\]\[+-\]\[rwx\] number   | 增加或者减少读取、写入或者执行权限<br>修改成数字形式标识的权限 |

## 数据文件处理

| 用途         | 命令   | 参数               | 参数说明                                         |
|--------------|--------|--------------------|--------------------------------------------------|
| 排序数据     | sort   | -n                | 按字符串数值大小排序                              |
|              |        | -h                | 按方便人们阅读的方式排序 (K, M, G, T 等)         |
|              |        | -M                | 按三字符月份名排序                                |
|              |        | -k n              | 从第 n 列开始排序 (n >= 1)                      |
|              |        | -r                | 反序显示                                        |
|              |        | -t                | 指定排序时所用的栏位分隔符                       |
|              |        | FILE              | 数据文件                                        |
| 压缩解压缩文件 | gzip   | -r               | 递归压缩解压缩文件                               |
|              |        | -d               | 解压缩                                          |
|              |        | [FILE]           | 欲压缩解压缩的文件，不能是目录                    |
| 归档文件     | tar    | -c               | 创建新的归档文件                                 |
|              |        | -x               | 从已有归档文件中提取文件                         |
|              |        | -z               | 压缩文件内容                                    |
|              |        | -v               | 处理文件时显示文件                               |
|              |        | -f FILE          | 输出结果到文件                                   |
|              |        | [OBJ...]         | 欲归档的源文件或目录                             |


# 进程

## 进程监测

| 用途         | 命令   | 参数         | 说明                                       |
|--------------|--------|--------------|------------------------------------------|
| 查看进程     | `ps`   | `-e`         | 显示所有进程                              |
|              |        | `-l`         | 显示长列表                                |
|              |        | `-f`         | 完整格式输出                              |
|              |        | `-L`         | 显示进程中的线程                          |
|              |        | `-o val`     | 显示 sth，如 `pid,%cpu,comm` 等           |
| 实时查看进程 | `top`  | N/A          | 实时显示所有进程                          |
|              | `htop` | N/A          | 可完美替代 `top`                          |
| 结束进程     | `kill` | `-n`<br>`PID` | 向指定进程发送信号，杀死进程：`"kill -9 PID"` |
|              | `killall` | `NAME` | 进程名，支持通配符，小心使用               |

### ps

`ps -elf` 显示内容解释：

- **S**: 进程的状态
  - R-正在运行或可运行，  
  - S-可中断休眠，
  - D-不可中断休眠，
  - I-空闲，
  - T-停止，
  - Z-僵死，即进程已结束但父进程不存在
- **UID**: 启动这些进程的用户  
- **PID**: 进程 ID  
- **PPID**: 父进程进程号  
- **C**: 进程生命周期中的 CPU 利用率  
- **PRI**: 进程优先级  
- **NI**: 谦让度 (nice) 值用来参与决定优先级  
- **ADDR**: 进程的内存地址  
- **SZ**: 假如进程被换出，所需交换空间的大致大小  
- **WCHAN**: 进程休眠的内核函数地址  
- **STIME**: 进程启动时的系统时间  
- **TTY**: 进程启动时的终端设备  
- **TIME**: 运行进程需要的累计 CPU 时间  
- **CMD**: 启动的程序名称

### top

top 上半部分的内容：

- **系统概况**：  
  - 当前时间、系统运行时间、  
  - 登录用户数、  
  - 平均负载（1分钟、5分钟、15分钟）
- **进程概要**：任务/进程数、各种状态的进程数量  
- **CPU 概要**：  
  - us - 用户空间占用 CPU 百分比，  
  - sy - 内核空间占用 CPU 百分比，  
  - ni - 用户进程空间内改变过优先级的进程占用 CPU 百分比，  
  - id - 空闲 CPU 百分比，  
  - wa - 等待输入输出的 CPU 时间百分比，  
  - hi - 硬件 CPU 中断占用百分比，  
  - si - 软中断占用百分比，  
  - st - 虚拟机占用百分比  
- **内存概要**：  
  - 物理内存总量，空闲内存总量，  
  - 已使用内存总量，  
  - 用作内核缓存的内存量

top 下半部分的内容：

- **PID**: 进程 ID  
- **USER**: 进程所有者的用户名  
- **PR**: 优先级  
- **NI**: nice 值（越小优先级越高）  
- **VIRT**: 进程能访问的虚拟内存总量（kb）  
- **RES**: 进程消耗的实际内存总量  
- **SHR**: VIRT 中有多少是共享的  
- **S**: 进程状态  
- **%CPU**: CPU 占用百分比  
- **%MEM**: 进程使用的物理内存百分比  
- **TIME+**: 进程启动到目前为止的 CPU 时间（单位 10ms）  
- **COMMAND**: 程序名

# 磁盘

## 磁盘监测

| 用途                     | 命令    | 参数                | 参数说明                           |
|--------------------------|---------|---------------------|------------------------------------|
| 挂载设备                 | mount   | N/A                 | 显示所有挂载的设备                 |
|                          |         | SOURCE              | 欲挂载的设备文件                   |
|                          |         | DIRECTORY           | 挂载点                             |
| 卸载设备                 | umount  | \[DIR\|DEVICE\]       | 挂载点或者设备文件                 |
| 查看磁盘使用情况         | df      | N/A                 | 易读方式显示                       |
|                          |         | -h                  |                                     |
| 查看文件和目录占用磁盘空间情况 | du     | -s                 | 显示每个项目的总的大小             |
|                          |         | -h                  | 易读方式显示                       |
|                          |         | -c                 | 所有已列出项目的总的大小           |
|                          |         | \[FILE\]             | 文件或者目录                       |

# 文本

grep, sed, awk 中单引号和双引号用法存在区别：

- 单引号：内容完全原样传递给工具，适合不含 Shell 变量、含特殊字符的场景。
- 双引号：内容先被 Shell 预处理（解析变量、部分转义），适合需要引用 Shell 变量的场景

简单说：只要脚本 / 模式中不含 Shell 变量，优先用单引号（避免 Shell 干扰工具的特殊符号）；若需要引用 Shell 变量，则必须用双引号，但需注意转义工具的特殊符号（如 awk 中的 $1 需写成 \$1）。

| 常见用途      | 命令                          | 参数                 | 参数说明                                      |
|---------------|-------------------------------|----------------------|---------------------------------------------|
| 过滤文本      | grep \[OPTS\] PATTERNS FILES   | -v                  | 选择不包含指定 PATTERN 的行                  |
|               |                               | -r                  | 递归查找                                     |
|               |                               | -I                  | 忽略二进制文件                               |
|               |                               | -i                  | 忽略大小写 |
|               |                               | -A n               | 显示匹配行后面 n 行                         |
|               |                               | -B n               | 显示匹配行前面 n 行                         |
|               |                               | -C n               | 显示匹配行前后 n 行                         |
|               |                               | -E                  | 启用扩展正则表达式（ERE）                  |
|               |                               | PATTERN            | 待匹配的字符                                 |
|               |                               | FILE               | 欲查找的文件                                 |
|               |                               | -n | 显示行号 |
| 处理行        | sed \[OPTS\] \[PATTERNs\] FILES | -n                 | 不打印模式空间的内容，只打印必要内容              |
|               |                               | m, n               | 数字方式行寻址，从 m 到 n 行，`$` 为最后一行    |
|               |                               | -i                 | 在原始文件上修改 |
|               |                               | -E                  | 启用扩展正则表达式（ERE）                  |
|               |                               | -e                  | 编辑命令，用于多个编辑任务                  |
|               |                               | PATTERN            | 文本过滤方式寻址，如 `/xxx/`，与 vim 类似     |
|               |                               | d                  | 删除匹配的行                                |
|               |                               | p                  | 打印当前模式空间的内容                      |
|               |                               | c                  | 修改匹配的行                                |
|               |                               | i                  | 在匹配的行前插入                            |
|               |                               | a                  | 在匹配的行后追加                            |
|               |                               | =                  | 显示行号                            |
|               |                               | FILE               | 待处理的文件                                 |
| 处理列        | awk [OPTS] PROGRAM FILES      | -F                 | 分隔符                                       |
|               |                               | `-v <变量名>=<值>`|  设置 awk 内部的变量值。可以使用该选项将外部值传递给 awk 脚本中的变量。 |
|               |                               | `-f <脚本文件>`| 指定一个包含 awk 脚本的文件。这样可以在文件中编写较大的 awk 脚本，然后通过 -f 选项将其加载。 |
|               |                               | '{PROGRAM}'        | 程序脚本，格式为 `"pattern {action}"`，含义为对于文件 filename 的每一行，如果能够符合条件 pattern，则执行动作 action。如果不写 pattern，则表示对于文件 filename 的每一行，都进行 action 处理。                                    |
|               |                               | FILE               | 待处理文件                                   |

## sed

sed 可以使用诸如 `"/Popeye/ s/.*/JOSDIOFJ/g"` 这种模式串，表示出现了 Popeye 的行，我们把这些行全修改为其他内容。

sed 处理 -e 的顺序为：多个 -e 选项指定的编辑命令会按照顺序依次应用到每一行文本上，而不是先处理完整个文件的第一个 `-e` 命令再处理整个文件的第二个 `-e` 命令。

sed 不支持 `\d`，以及一些其他方便的元字符！且在输入类似 `{1,2}` 的时候，如果开了 `-E` 花括号无需转义。

## awk

- `$0`: 整条记录；记录分隔符默认为换行符
- `$n`: 表示某条记录的第n个字段(n>=1)；字段分隔符默认为空格
- `ARGC`: 	命令行参数的数目
- `ARGIND`: 	命令行中当前文件的位置(从0开始算)
- `ARGV`: 	包含命令行参数的数组
- `CONVFMT`: 	数字转换格式(默认值为%.6g)ENVIRON环境变量关联数组
- `ERRNO`: 	最后一个系统错误的描述
- `FIELDWIDTHS`: 	字段宽度列表(用空格键分隔)
- `FILENAME`: 	当前文件名
- `FNR`: 	各文件分别计数的行号
- `FS`: 	字段分隔符(默认是任何空格)
- `IGNORECASE`: 	如果为真，则进行忽略大小写的匹配
- `NF`: 	一条记录的字段的数目
- `NR`: 	已经读出的记录数，就是行号，从1开始
- `OFMT`: 	数字的输出格式(默认值是%.6g)
- `OFS`: 	输出字段分隔符，默认值与输入字段分隔符一致。
- `ORS`: 	输出记录分隔符(默认值是一个换行符)
- `RLENGTH`: 	由match函数所匹配的字符串的长度
- `RS`: 	记录分隔符(默认是一个换行符)
- `RSTART`: 	由match函数所匹配的字符串的第一个位置
- `SUBSEP`: 	数组下标分隔符(默认值是/034)

如 `awk '{print $0}'`，为打印整行。

ask 的分隔符部分相当符合正则表达式，比如有 `,`, `^` 和 `---` 做分隔符时，应写成 `[,^]|---` 或者写成 `,|\\^|---`。注意 `^` 那里应该写两个反划线。

awk 的 pattern 与其他软件类似，故不详细写了。

awk 的 action 格式大致如下：

```bash
BEGIN {
    ...
}
{
    ...
}
END {
    ...
}
```

它的执行顺序为：
1. 执行 BEGIN 语句段内的语句
2. 对文本每一行执行一次中间语句段的语句
3. 执行 END 语句段内的语句

函数：

- `gsub(regex, replacement, target)`：替换所有匹配项
- `sub(regex, replacement, target)`: 仅替换第一个
- `match($0, /pattern/, m)`: 在 `$0`（整行）中匹配正则 pattern，第三个参数是一个数组 m，用于存储捕获组内容。

| 运算符       | 描述                           |
| ------------ | ------------------------------ |
| `+= -= *= /= %= ^= **=` | 赋值                           |
| `?:`         | C条件表达式                    |
| `\|\|`         | 逻辑或                         |
| `&&`         | 逻辑与                         |
| `~` 和 `!~`  | 匹配正则表达式和不匹配正则表达式 |
| `< <= > >= != ==` | 关系运算符                     |
| 空格         | 连接                           |
| `+ -`        | 加，减                         |
| `* / %`      | 乘，除与求余                   |
| `+ - !`      | 一元加，减和逻辑非             |
| `^ ***`      | 求幂                           |
| `++ --`      | 增加或减少，作为前缀或后缀     |
| `$`          | 字段引用                       |
| `in`         | 数组成员                       |

# 一些其他的内容

- SSH
- SCP
- SFTP
- tcpdump：Tcpdump, dump the traffic on a network, 可以将网络中传输的数据包的“包头”全部捕获过来进行分析，其支持网络层、特定的传输协议、数据发送和接收的主机、网卡和端口的过滤，并提供and、or、not等语句进行逻辑组合捕获指定的数据包或去掉不用的信息
- netstat
- wget
- curl

据说可以用 ctags + cscope + Vim 构筑 Linux C 开发 IDE。