---
layout: wiki
title: Vim
cate1: Tools
cate2: Editor
description: 个人最常用的 Vim 常用操作。
keywords: Vim
---

### 插入模式

| 功能                             | 按键 |
| -------------------------------- | ---- |
| 光标前插入                       | `i`  |
| 行首插入                         | `I`  |
| 光标后插入                       | `a`  |
| 行末插入                         | `A`  |
| 上一次更改的地方进入 insert 模式 | `gi` |

#### 插入模式下删除

以下功能均为在插入模式下启用。

| 功能                 | 按键     |
| -------------------- | -------- |
| 删除上一个输入的字符 | `Ctrl-h` |
| 删除上一个输入的单词 | `Ctrl-w` |
| 删除上一个输入的整行 | `Ctrl-u` |

#### 退出插入模式的三种方式

插入-普通模式可以执行一次普通模式命令，执行完后马上返回插入模式。比如可以在打字过程中想要把当前行放到屏幕中央，使用 `<C-o>zz` 切换成插入-普通模式后执行 `zz` 命令，然后再返回插入模式。

| 功能                | 按键                  |
| :------------------ | :-------------------- |
| 切换为普通模式      | `ESC / <C-[> / <C-c>` |
| 切换为插入-普通模式 | `<C-o>`               |

#### 表达式寄存器

插入模式下使用 `<C-r>=1+2<ENTER>` 即可输入计算后的值 3。不过在 VsCodeVim 插件中这个功能没有实装。而在 Vscode 的 neovim 插件中，该功能可以使用。

#### 二合字母插入非常用字符

插入模式下输入 `<C-k>{char1}{char2}` 即可。也可以使用命令行模式输入 `:digraphs` 查看可用的二合字母列表。

### 替换模式

用 `R` 或者 `<INSERT>` 进入替换模式。

Vim 也提供了一种虚拟替换模式，由 `gR` 命令触发，它可以把制表符当成一组空格进行处理。

### 可视模式 (visual mode)

- `v` 字符 visual mode
- `V` 行 visual mode
- `C-V` 块 visual mode
    - 选中后可以使用 `I` 在块中所有行前面输入
    - 选中后可以使用 `A` 在块中所有行后面输入
    - 这里 `i` 与 `a` 被视作文本对象的组成部分了。因此在可视模式下使用这两个无法插入。
- `gv` 重选上次的高亮选区
- `o` 切换高亮选区的活动端

可视模式使用 `.` 范式重复工作时，如果是面向行的高亮选取，往往会正常，但是如果是面向字符的高亮选取，容易产生意外结果，可能会导致只修改相同字符数个数的字符以及其他情况。

### 移动

**以字（符）为单位**

| 功能 | 按键 |
|:-----|:-----|
| 上   | `k`  |
| 下   | `j`  |
| 左   | `h`  |
| 右   | `l`  |

**以单词为单位**

| 功能                                                     | 按键 |
| :------------------------------------------------------- | :--- |
| 前一个单词尾                                             | `ge` |
| 后一个单词首，这里是由数字、字母、空格、符号等分割的单词 | `w`  |
| 后一个单词 ( WORD ) 首，这里是没空格分割的单词           | `W`  |
| 本单词首（已在本词首则跳到前一单词首）                   | `b`  |
| 本单词 (WORD) 首（已在本词首则跳到前一单词首）           | `B`  |
| 本单词尾（已在本词尾则跳到后一单词尾）                   | `e`  |

**以屏幕为单位**
 
| 功能                     | 按键     |
| :----------------------- | :------- |
| 向下翻页                 | `CTRL-f` |
| 向上翻页                 | `CTRL-b` |
| 向下翻半页               | `CTRL-d` |
| 向上翻半页               | `CTRL-u` |
| 向上一行                 | `CTRL-y` |
| 向下一行                 | `CTRL-e` |
| 返回跳转之前的位置       | `CTRL-o` |
| 光标移到屏幕上方         | `H`      |
| 光标移到屏幕中间         | `M`      |
| 光标移到屏幕下方         | `L`      |
| 光标所在位置移到屏幕上方 | `zt`     |
| 光标所在位置移到屏幕中间 | `zz`     |
| 光标所在位置移到屏幕下方 | `zb`     |

**以行与段为单位**

| 功能                                     | 按键                        |
| :--------------------------------------- | :-------------------------- |
| 跳到第 num 行                            | `:num` 或 `numG` 或 `numgg` |
| 跳转到第一个字符                         | `0`                         |
| 跳转到第一个非空字符                     | `^`                         |
| 跳转到最后一个字符                       | `$`                         |
| 跳转到最后一个非空字符                   | `g_`                        |
| 跳转到本行下一个 char 字符处             | f{char}                     |
| 跳转到本行上一个 char 字符处             | F{char}                     |
| 跳转到本行下一个 char 字符的上一个字符处 | t{char}                     |
| 跳转到本行上一个 char 字符的上一个字符处 | T{char}                     |
| 在使用 f{char} 后跳转到下一个 char 字符  | `;`                         |
| 在使用 f{char} 后跳转到上一个 char 字符  | `,`                         |
| 跳转到上一段                             | `{`                         |
| 跳转到下一段                             | `}`                         |

**文件**

| 功能                                 | 按键       |
| :----------------------------------- | :--------- |
| 跳到文件头                           | `gg`       |
| 跳到文件尾                           | `G`        |
| 跳到文件第 `{line}` 行               | `{line}gg` |
| 跳到匹配的 `({[]})` 上               | `%`        |
| 跳到光标下内容的定义 (goto define)   | `gd`       |
| 跳到光标下 import 的文件 (goto file) | `gf`       |

**数字的用法**

`{数字}{指令}`: 表示执行接下来的指令多少次。

可以在 vscode 的设置中把行号设置为相对行号。

### 操作符 (operators)

trick: 可以使用 '.' 重复上一次操作。

#### 复制

| 功能             | 按键        |
| :--------------- | :---------- |
| 复制光标所在单词 | `yiw`       |
| 复制光标所在行   | `yy` 或 `Y` |

#### 粘贴

| 功能           | 按键 |
|:---------------|:-----|
| 在光标之后粘贴 | `p`  |
| 在光标之前粘贴 | `P`  |
| 在光标之后粘贴后，光标移动到复制内容后 | `gp` |
| 在光标之前粘贴后，光标移动到复制内容后 | `gP` |

#### 剪切

| 功能           | 按键 |
| :------------- | :--- |
| 剪切选中区域   | `d`  |
| 剪切光标所在行 | `dd` |
| 剪切光标到行尾 | `D`  |

#### 寄存器

一般在使用寄存器复制/剪切/粘贴前需要按下 `"` 表示接下来要使用寄存器。

- The **匿名寄存器** `"` is where you copy and cut stuff to, when you don’t explicitly specify a register. The default register if you will.
- The **带名字寄存器** `a-z` are registers you can use explicitly to copy and cut text at will
- The **复制寄存器** `0` stores the last thing you have yanked (copied)
- The **剪切寄存器** `1-9` store the last 9 things you cut by using either the delete or the change command
- The **系统寄存器** `+` 保存系统粘贴板。
- The **黑洞寄存器** `_` 使用这个寄存器做剪切，Vim 将删除文本且不保存任何副本。
- **只读寄存器**
  - 当前文件名 `%`
  - 轮换文件名 `#`
  - 上次插入的文本 `.`
  - 上次执行的 Ex 命令 `:`
  - 上次查找的模式 `/`

可以使用 `:reg {register}` 来查看寄存器中保存的内容。用小写字母引用有名寄存器，会覆盖原始寄存器内容，而换用大写字母，则会将新内容添加到该寄存器的原有内容之后。使用 `:let @{register}='{string}'` 可以将寄存器中的内容设置为 `{string}` 的内容。

除此之外，可以使用寄存器中的内容来替换可视模式下高亮选区的文本。需注意，在按下 `p` 的时候，无名寄存器中的内容会被替换为高亮选区的文本。

**插入模式使用粘贴**: 输入 `Ctrl-R` + `{register}` 粘贴。

#### 修改

修改是类似于把 'd' 和 'i' 组合起来的按键。

| 功能           | 按键 |
| :------------- | :--- |
| 修改           | `c`  |
| 修改光标所在行 | `cc` |
| 修改光标到行尾 | `C`  |

#### 代码格式化

| 功能       | 按键 |
| :--------- | :--- |
| 代码格式化 | `=`  |
| 向左缩进   | `<`  |
| 向右缩进   | `>`  |

#### 一些更方便的操作
| 功能                             | 按键 |
| :------------------------------- | :--- |
| 删除光标下面的字符               | `x`  |
| 删除光标前面的字符               | `X`  |
| 删除光标下面的字符并进入插入模式 | `s`  |
| 删除整行文本并进入插入模式       | `S`  |
| 用一个字符替换一个字符           | `r`  |

#### 大小写

| 功能                 | 按键            |
| :------------------- | :-------------- |
| 将选中内容大小写互换 | `~`             |
| 将选中内容全转为小写 | `gu`            |
| 将选中内容全转为大写 | `gU`            |
| 将大小写互换         | `g~`            |
| 将当前行变成小写     | `guu`           |
| 将当前行变成大写     | `gUU`           |
| 将匹配内容替换为大写 | `:%s/xxx/\U&/g` |
| 将匹配内容替换为小写 | `:%s/xxx/\L&/g` |

注：`&` 代表正则表达式全部匹配项，另外还有 `\1`、'\2'、...、`\9` 代表第 1 到 9 个匹配项。

### 文本对象 (Text Object)

文本对象是结构化的文本片段，或者，如果你愿意，文档域模型的实体。文档是由什么组成的？单词、句子、引用文本、段落、块、（超文本标记语言）标签等。这些是文本对象。

在命令中指定文本对象的方式是将字母 a (a text object plus whitespace) or i (inner object without whitespace) 与表示文本对象本身的字符组合起来：

```
{operator}{a|i}{text-object}
```

例如，普通的 `cw` 只能删除光标后的单词，而 `ciw` 是删除整个单词。text-object 可以有如下内容：

- w: word
- s: sentence
- p: paragraph
- ": 这个比较特殊，对于单/双引号而言，使用这种指令甚至可以不在引号内部。在外面也可以使用。
- (/[/{/<: 括号，其中 `b` 与 `(` 等价，`B` 与 `{` 等价。
- t: tag. HTML 中可能会用到。

### Command-line 模式

- `:edit {relative-path-to-file}`
  - 由于 VscodeVim 不支持这里 Tab 补全，因此本指令主要用于创建新文件。
  - 简略版本是 `:e`。
- `:wa` 保存所有文件，`:qa` 关闭所有文件

#### 操作

这里特指使用 `d`, `c`, `y` 类似的操作。`:[range]command[options]` 是这种操作的格式。

例如，删除的格式为：`:[range]d [register]`，有：

- 使用数字 (e.g. :10,12d to delete lines 10, 11 and 12)
- 使用偏移量 (e.g. :10,+2d to delete lines 10, 11 and 12)
- 使用 `.` 表示当前行 (e.g. :.,+2d to delete the current line and the next two ones)
- 使用 `%` 表示当前文件所有行 (e.g. :%d to delete the whole file)
- 使用 `0` 表示文件的开头 (e.g. :0,+10d to delete the first 10 lines)，一般用于把某些行移动或复制到文件开头。
- 使用 `$` 表示文件的结尾 (e.g. :.,$d to delete from the current line to the end of the file)
- 如果使用可视模式时，使用 `:'<,'>` 表示现在可视模式下选择的范围。`'<` 表示首位置，`'>` 表示末位置。如果在普通模式使用，会使用上一次高亮选区所选中的内容。
- Vim 也接受以模式作为一条 Ex 命令的地址，如 `:/<html>/,/<\html>/d a` 表示删除 html 标签中所有内容并保存在 `a` 寄存器中。
- 也可以在模式的基础上加上偏移，如：`:/<html>/+1,/<\html>/-1d a` 表示除了 html 标签外，内部全部删除。

`:yank`, `:put`, `:copy`, `:move` 在 VSCodeVim 下不支持，除非集成 NeoVim。

- `:[range]delete [register]` 删除 `[range]` 范围内的内容，保存到 `[register]` 中。简写为 `:d`
- `:[range]yank [register]` 复制 `[range]` 范围内的内容，保存到 `[register]` 中。简写为 `:y`
- `:[range]put [register]` 把 `[register]` 中的内容粘贴到指定位置 `[range]` 中。简写为 `:pu`
- `:[range]copy {address}` 把 `[range]` 范围内的内容复制到 `{address}` 地址。简写为 `:t`
- `:[range]move {address}` 把 `[range]` 范围内的内容移动到 `{address}` 地址。简写为 `:m`

#### 重复上一次操作

使用 `@:` 重复上一次的 ex command，如果要再次重复要使用 `@@`。有一些诸如跳缓冲区的操作，可以使用 `<C-o>` 反过来跳回去，但是有一些修改操作请使用 `u` 键还原。

#### 替换

这里的格式为：`:[range]s/{pattern}/{string}/[flags]`，可以使用 `&` 来重复操作。

- `range` 给定范围。
  - 不写仅指定当前行;
  - `%`：全文;
  - 10,20：替换第 10 行到第 20 行;
- `pattern` 是模式串。比如 `/{pattern}` 支持正则表达式.
- `string` 是要修改成的字符串
- `flags` 表示一些设置。
  - `g` 表示一行内全部
  - `i` 表示不区分大小写
  - `c` 表示确认每一次替换
  - `n` 表示抑制正常的替换行为，会让 Vim 只报告 substitute 命令匹配的个数。
  - `e` 屏蔽错误信息
  - `&` 重用上一次 substitute 命令中使用的标志位。

| 功能                              | 按键                |
|:----------------------------------|:--------------------|
| 将全文中的 str1 替换为 str2       | `:%s/str1/str2/g`   |
| 将 1 到 5 行中的 str1 替换为 str2 | `:1,5s/str1/str2/g` |

**替换域（`{string}`）中的特殊字符**

| 符号             | 描述                                                      |
| :--------------- | :-------------------------------------------------------- |
| `\r`             | 插入一个换行符                                            |
| `\t`             | 插入一个制表符                                            |
| `\\`             | 插入一个反斜杠                                            |
| `\1`             | 插入第 1 个子匹配                                         |
| `\2`             | 插入第 2 个子匹配，最大到 `\9`                            |
| `\0`             | 插入匹配模式的所有内容                                    |
| `&`              | 插入匹配模式的所有内容                                    |
| `~`              | 使用上一次调用 `:substitute` 时的 `{string}`              |
| `\={Vim script}` | 执行 `{Vim Script}` 表达式，并将返回的结果替换 `{string}` |

在 Vim 脚本中，可以用 `@{register}` 来引用某个寄存器的内容；除此之外，Vim 脚本中只能使用 `submatch(1)`，**不能使用 `\1`**，这里要注意。

**手动控制替换**

| 功能                         | 按键    |
| :--------------------------- | :------ |
| 替换此处匹配                 | `y`     |
| 忽略此处匹配                 | `n`     |
| 退出替换过程                 | `q`     |
| last-替换此处匹配之后退出    | `l`     |
| all-替换此处与之后所有的匹配 | `a`     |
| 向上滚动屏幕                 | `<C-e>` |
| 向下滚动屏幕                 | `<C-y>` |

如果某一次替换忘记加上前缀 `%`，那么可以直接使用 `g&` 命令，它等价于 `:%s//~/&` 即用同样的标志位、同样的替换字符串、同样的查找模式以及新的执行范围 `%`，重复上一次的 substitute 命令。

`g&` 命令本质上是 `:%&&` 的快捷方式。第一个 `&` 作为 Ex 命令 `:&` 的组成部分，用作重复上一次的 :substitute 命令，共享相同的模式串和替换串；而第二个 `&` 则会重用上一次 `:s` 命令的标志位。具体而言：

| 功能                   | 按键           |
| :--------------------- | :------------- |
| 全局执行上一次替换     | `g&` 或 `:%&&` |
| 当前行执行上一次替换   | `:&&`          |
| 高亮选区执行上一次替换 | `:'<,'>&&`     |

#### `:global` 命令

`:global` 命令允许我们在某个指定模式的所有匹配行上运行 Ex 命令。简写为 `:g`。

```vim
:[range] global[!] /{pattern}/ [cmd]
```

在默认情况下，`:global` 的作用范围是整个文件（`%`）。`[cmd]` 可以是除了 `:global` 之外的所有 Ex 命令。若不指定，则会缺省使用 `:print`。

`:global!` 或者 `:vglobal` 可以反转 `:global` 的行为。这两条命令将指示 Vim 在没有匹配到指定模式的行上执行 `[cmd]`。`:vglobal` 简写为 `:v`。

使用 `:global` 与 `:yank` 配合时，请**使用大写寄存器**，这样表示依次把内容附加到寄存器中。

在 Ex 命令中，`.` 符号通常表示光标所在行，但在 `:global` 命令的上下文中，它表示 `{pattern}` 的匹配行。因此，`:global` 的广义形式如下：

```vim
:g/{start}/ .,{finish} [cmd]
```

#### 复制与移动

| 功能                    | 按键                                              |
| :---------------------- | :------------------------------------------------ |
| 复制到 {address} 行下方 | `:[range]copy {address}` 或 `:[range]t {address}` |
| 移动到 {address} 行下方 | `:[range]move {address}` 或 `:[range]m {address}` |

#### 在指定范围上执行普通模式命令

可以使用 `:[range]normal {normal_command}` 来在范围内执行普通模式命令，可以和 `.` 或者其他命令结合起来。

#### 把当前单词插入到命令行

- 可以在命令行模式下使用 `<C-r><C-w>` 来插入光标下的单词。
- 可以在命令行模式下使用 `<C-r><C-a>` 来插入光标下的字串。

#### 打开命令行窗口

VscodeVim 中的命令行窗口内容无法修改，只能查看。

| 功能                         | 按键    |
| :--------------------------- | :------ |
| 打开查找命令历史的命令行窗口 | `q/`    |
| 打开 Ex 命令历史的命令行窗口 | `q:`    |
| 从命令行模式切换到命令行窗口 | `<C-f>` |

### 选择

| 功能                 | 按键                |
|:---------------------|:--------------------|
| 选中上一次选择的区域 | `gv`                |
| 选中括号内区域       | `vi{`、`vi[`、`vi(` |

### 按模式匹配及按原义匹配

Vim 的默认搜索模式为 magic 搜索模式，它会自动为某些额外的符号赋予特殊含义，例如：`.*[]` 等，但是它没有为诸如 `+?(){}` 等符号赋予特殊含义，因此需要使用 `\v` 指定正则。

注意，在 Vim 中 `\s` 是除了换行符以外的所有空白字符，`\_s` 才是所有空白字符。这与常规正则表达式不同，常规正则表达式中，`\s` 表示了所有空白字符。除此之外，单词的边界在 Vim 中是 `\<` 和 `\>`，分别代表单词开头和结尾，而在常规正则表达式中则是 `\b`。

在 Vim 中，如果在圆括号前面加上 `%`，可以使 Vim 不将括号内的内容赋给寄存器 `\1`。如：`/\v%(And|D)rew Neil` 中，运行速度会有所优化。

- 正向查找要转义 `/` 号
- 反向查找要转义 `?` 号
- 每次都要转义 `\` 号

| 功能                       | 字符  |
| :------------------------- | :---- |
| 忽略大小写                 | `\c`  |
| 强制大小写                 | `\C`  |
| 强制正则 very magic        | `\v`  |
| 强制原义 very nomagic      | `\V`  |
| 匹配的开头，前面不计入匹配 | `\zs` |
| 匹配的结尾，后面不计入匹配 | `\ze` |

#### 用编程的方式转义字符

`escape({string}, {chars})` 函数中，`{chars}` 参数指定哪些字符需要用反斜杠转义，假如有一段文本保存在寄存器 `u` 中，然后输入 `/` 或者 `?` 调出查找提示符，最后，依次输入原义开关 `\V` 与 `<C-r>=`，Vim 会切换到表达寄存器提示符状态，再输入下面的命令：`escape(@u, getcmdtype().'\')`，这个命令中，`@u` 取出寄存器 `u` 中的内容，`getcmdtype()` 则会返回先前输入的是 `/` 或 `?`，然后利用 `.` 操作把字符串连接起来（Vim 中使用 `.` 连接字符串）。

### 搜索

把查找域留空时，会重复上一次的模式串。

`n` 和 `N` 会因为使用 `/str` 或是 `?str` 产生方向上的变化。

| 功能                                                           | 按键         |
| :------------------------------------------------------------- | :----------- |
| 向下查找字符串                                                 | `/str`       |
| 向上查找字符串                                                 | `?str`       |
| 正向跳转至相同模式的下一处匹配                                 | `/<CR>`      |
| 反向跳转至相同模式的下一处匹配                                 | `?<CR>`      |
| 查找下一个                                                     | `n`          |
| 查找上一个                                                     | `N`          |
| 向下查找光标所在单词                                           | `*`          |
| 向上查找光标所在单词                                           | `#`          |
| 搜索完成后普通模式下使用，选中下面第一个匹配内容并进入可视模式 | `gn`         |
| 搜索完成后普通模式下使用，选中上面第一个匹配内容并进入可视模式 | `gN`         |
| 将光标偏移到查找匹配的结尾                                     | `/str/e<CR>` |

`gn` 和 `gN` 可以和 `.` 结合起来，按下 `.` 自动跳转到下一个。

可以使用 `:set nohlsearch` 禁用高亮查找功能。

在 Vim 中，对完整的查找匹配进行动作操作非常麻烦，在《Vim 实用技巧》技巧 84 对完整的查找匹配进行操作有详细论述。作者的建议是使用 testobj-lastpat 插件，其中加入了 `i/` 文本对象用于操作查找匹配。

### 正则表达式

| 功能           | 按键                |
|:---------------|:--------------------|
| 匹配单词左边界 | `\<`                |
| 匹配单词右边界 | `\>`                |
| 匹配重复单词   | `\v<(\w+)\_s+\1>`   |
| 去重           | `:g/^\(.*\)$\n\1/d` |

### 常用

| 功能                           | 按键          |
| :----------------------------- | :------------ |
| 删除空行                       | `:g/^$/d`     |
| 撤销/UNDO                      | `u`           |
| 重做/REDO                      | `<C-r>`       |
| 统计行/单词/字符/字节数        | `g <C-g>`     |
| 对光标后第一个的数字执行加操作 | `<C-a>`       |
| 对光标后第一个的数字执行减操作 | `<C-x>`       |
| 去掉 UTF-8 BOM                 | `:set nobomb` |
| 保留 UTF-8 BOM                 | `:set bomb`   |

在执行 `<C-a/x>` 时，如果数字以 0 开头，那么 Vim 会将其视为八进制。

### 全局

| 功能         | 按键 |
|:-------------|:-----|
| 退出         | `:q` |
| 强制执行     | `!`  |
| 执行外部命令 | `:!` |

### 文件操作

| 功能               | 按键      |
|:-------------------|:----------|
| 打开               | `:e`      |
| 打开文件对话框     | `:bro e`  |
| 保存               | `:w`      |
| 另存为对话框       | `:bro w`  |
| 查看历史文件列表   | `:ol`     |
| 查看并打开历史文件 | `:bro ol` |
|重命名当前文件|`:f filename`|

### vimdiff

| 功能                   | 按键          |
|:-----------------------|:--------------|
| 移动到上一个不同处     | `[c`          |
| 移动到下一个不同处     | `]c`          |
| 该差异点使用当前文件的 | `dp`          |
| 该差异点使用其它文件的 | `do`          |
| 手动刷新重新比较       | `:diffupdate` |

### Buffer

| 功能                               | 按键     |
|:-----------------------------------|:---------|
| 查看 Buffer 列表                   | `:ls`    |
| 转到 Buffer 列表中的下一个 Buffer  | `:bn`    |
| 转到 Buffer 列表中的上一个 Buffer  | `:bp`    |
| 转到 Buffer 列表中的 num 号 Buffer | `:bnum`  |
| 你之前待过的一个 Buffer            | `:b#`    |
| 从 Buffer 列表中删除 num 号 Buffer | `:bdnum` |

### 组合命令

可以使用 `|` 来组合命令，比如 `cmd1 | cmd2`。

### 代码

| 功能                    | 按键                           |
|:------------------------|:-------------------------------|
| 格式化代码              | `gg=G`                         |
| 去除 1-20 行首的行号    | `:1,20s/^\\s\*[0-9]\*\\s\*//g` |
| 展开全部折叠            | `zR`                           |
| 展开当前层级折叠        | `zr`                           |
| 全部折叠                | `zM`                           |
| 当前层级折叠            | `zm`                           |
| 切换折叠/展开           | `za`                           |
| 递归折叠/展开当前大区块 | `zA`                           |
| 折叠当前区块            | `zc`                           |
| 递归折叠当前大区块      | `zC`                           |
| 展开当前区块            | `zo`                           |
| 递归展开当前大区块      | `zO`                           |
| 格式化 json 数据        | `:%!python -m json.tool`       |
| 缩进当前行              | `>>`                           |
| 反缩进当前行            | `<<`                           |

### 宏

在一组目标上执行宏可以有两种方式——以串行方式回放或者以并行方式多次运行。

录制一个宏的时候，要确保每条命令都可被重复执行；禁止使用鼠标。如果宏执行动作命令失败了，Vim 将中止执行宏的其余命令。

点范式不能指定执行次数，因此使用宏加数字多次执行。其中，串行执行宏仅需要普通模式下调用即可；而并行模式则需要选中文本后进入 Ex 模式输入 `normal @{register}` 才可启用。

| 功能                   | 按键                       |
| :--------------------- | :------------------------- |
| 录制宏并保存到寄存器中 | `q{register}`              |
| 停止录制宏             | `q`                        |
| 执行寄存器中的宏       | `@{register}`              |
| 执行上一次执行的宏     | `@@`                       |
| 串行执行宏             | `{num}@{register}`         |
| 并行执行宏             | `:'<,'>normal @{register}` |

如果要在宏中追加命令，请使用 `q{大写字母}` 的方式。但是此方法只能在结尾追加指令。

同时，也可以编辑寄存器，内容，使用 `:put {register}` 粘贴当前行下方。然后如果使用 `"add` 来删除并保存到寄存器 `a` 中的话，由于 `dd` 面向行操作，可能会出现拖尾字符 `^J`。因此推荐使用复制 `"ay$` 来保存到寄存器中。

除此之外，在 Vscode 的 Neovim 插件中使用宏时，如果使用了表达式寄存器，`<C-r>=` 后请先退出插入模式再进入插入模式，否则会出现宏中插入模式后续内容被丢弃的现象。

### modeline

写法：

```
 vim: set ft=markdown:
 vim: ft=markdown

// vim: noai:ts=4:sw=4
/* vim: noai:ts=4:sw=4 */
```

### 插件

在 VscodeVim 插件中，可以在 `settings.json` 文件中输入：

```json
  "vim.handleKeys": {
    "<C-p>": false
  }
```

这样使用 Vscode 原生的 `<C-p>` 来打开文件。但是其实这个插件非常不好，相较于 Vscode 中的 neovim 插件，搜索中文时经常有 bug，除此之外没有表达式寄存器，还有一系列功能均没有。

#### CtrlP

基础按键 `C-p`

| 功能                               | 按键      |
|:-----------------------------------|:----------|
| 刷新列表                           | `F5`      |
| 切换文件/缓冲区/MRU                | `C-f/b`   |
| 切换全路径搜索/文件名搜索          | `C-d`     |
| 切换正则表达式模式                 | `C-r`     |
| 上/下一个选项                      | `C-k/j`   |
| 在新标签/垂直分割/水平分割打开文件 | `C-t/v/x` |
| 历史选择记录的上/下一条            | `C-p/n`   |
| 创建文件和它的父路径               | `C-y`     |
| 标记并打开多个文件                 | `C-z C-o` |
| 退出 CtrlP                         | `C-c`     |

#### LeaderF

| 功能                               | 按键                   |
|:-----------------------------------|:-----------------------|
| 打开文件                           | `Leader-f`             |
| 打开缓冲区                         | `Leader-b`             |
| 打开 MRU                           | `Leader-m`（自定义的） |
| 退出                               | `C-c`                  |
| 切换模糊查找和正则查找             | `C-r`                  |
| 粘贴                               | `C-v`                  |
| 清空输入                           | `C-u`                  |
| 上/下一个选项                      | `C-k/j`                |
| 在新标签/垂直分割/水平分割打开文件 | `C-t/]/v`              |
| 刷新列表                           | `F5`                   |

#### vim-table-mode

| 功能           | 按键         |
|:---------------|:-------------|
| 删除列         | `Leader-tdc` |
| 删除行         | `Leader-tdd` |
| 重新格式化表格 | `Leader-tr`  |

#### markdown-preview.nvim

| 功能     | 按键 |
|----------|------|
| 预览     | `F5` |
| 停止预览 | `F6` |

导出 PDF：预览以后，使用浏览器的「打印」功能，打印机选「另存为 PDF」，取消「页眉和页脚」，然后点保存即可。

### 命令行

打开 Vim 时跳转到指定行：

```
vim +[num] filename
```

num 表示行号，不填则跳转到文件末尾。

### 屏幕分块 (splits and tabs)

#### splits

- `:sp {relative-path-to-file}` 水平 split
- `:vsp {relative-path-to-file}` 垂直 split
- `Ctrl-w s` 水平 split
- `Ctrl-w v` 垂直 split
- `Ctrl-w` + `hjkl` 在 split 间移动。

#### tabs

- `:tabnew {file}` 在一个新 tab 中打开文件
- `:tabn` (`:tabnext`) 下一个 tab
- `:tabp` (`:tabprevious`) 上一个 tab
- `:tabo` (`:tabonly`) 关掉所有其他 tabs。